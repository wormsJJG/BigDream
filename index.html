<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' https://www.gstatic.com https://apis.google.com https://esm.sh;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
    font-src 'self' https://fonts.gstatic.com;
    img-src 'self' data: https://*.googleusercontent.com https://lh3.googleusercontent.com;
    connect-src 'self' https://*.googleapis.com https://*.firebaseio.com https://*.cloudfunctions.net https://identitytoolkit.googleapis.com https://securetoken.googleapis.com https://www.gstatic.com https://esm.sh;
">
    <title>BD-Scanner</title>
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client"
        }
    }
    </script>
    <script type="module" src="renderer.js"></script>
    <link rel="stylesheet" href="style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">
</head>

<body>
    <div id="logged-out-view" class="app-view active">
        <nav class="sidebar">
            <div class="logo-area">
                <span class="app-title" id="admin-title-trigger">BD SCANNER</span>
            </div>
            <ul class="nav-menu">
                <li id="nav-login" class="nav-item active" data-screen="login-screen">
                    <span>로그인</span>
                </li>
                <li id="nav-support" class="nav-item" data-screen="support-screen">
                    <span>고객센터</span>
                </li>
            </ul>
        </nav>
        <main class="main-content">
            <section id="login-screen" class="screen active">
                <div class="content-card login-card">
                    <h2>환영합니다</h2>
                    <p>로그인하여 서비스를 시작하세요.</p>
                    <form id="login-form">
                        <input type="text" id="username" placeholder="아이디">
                        <input type="password" id="password" placeholder="비밀번호">
                        <p id="login-error" class="error-message" style="margin: 0;"></p>
                        <button type="submit" class="primary-button">로그인</button>
                    </form>
                </div>
            </section>
            <section id="support-screen" class="screen">
                <div class="content-card support-card">
                    <img src="./assets/icon-headset.svg" alt="Support Icon" class="support-icon">
                    <h1>BigDream Security Solutions</h1>
                    <p class="support-subtitle">
                        BigDream에서 개발한 안드로이드 및 iOS 악성프로그램 검사 프로그램입니다.
                    </p>
                    <div class="support-contact">
                        <p><strong>사용 문의 및 기술 지원</strong></p>
                        <span>010-8119-1837</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="logged-in-view" class="app-view">
        <nav class="sidebar">
            <div class="logo-area">
                <span class="app-title">BD SCANNER</span>
            </div>
            <ul class="nav-menu">
                <li id="nav-create" class="nav-item active"><span>검사생성</span></li>
                <li id="nav-open" class="nav-item"><span>검사열기</span></li>
                <li id="nav-result" class="nav-item hidden"><span>검사결과</span></li>
            </ul>
            <div class="sidebar-footer">
                <button id="logout-btn" class="sidebar-button">로그아웃</button>
            </div>
        </nav>

        <main class="main-content">
            <section id="create-scan-screen" class="screen active">
                <div id="agency-info-display">
                    <div id="agency-name">(주) BD SCANNER</div>
                    <div id="agency-quota">남은 횟수 : 로딩 중</div>
                </div>
                <h2>검사 생성</h2>
                <p>검사를 진행할 대상자의 정보를 입력해주세요.</p>
                <div class="content-card input-card-relative">
                    <button id="reset-client-info-btn" type="button" class="reset-icon-btn">↺ 정보 초기화</button>
                    <form id="client-info-form">
                        <div class="form-group-anon">
                            <label for="client-name">대상자 이름</label>
                            <div class="input-and-anon">
                                <input type="text" id="client-name">
                                <label for="anon-name" class="anon-label">
                                    <input type="checkbox" id="anon-name" class="anon-check">
                                    익명
                                </label>
                            </div>
                        </div>

                        <div class="form-group-anon">
                            <label for="client-dob">생년월일</label>
                            <div class="input-and-anon">
                                <input type="date" id="client-dob">
                                <label for="anon-dob" class="anon-label">
                                    <input type="checkbox" id="anon-dob" class="anon-check">
                                    익명
                                </label>
                            </div>
                        </div>

                        <div class="form-group-anon">
                            <label for="client-phone">휴대폰 번호</label>
                            <div class="input-and-anon">
                                <input type="tel" id="client-phone" placeholder="010-1234-5678">
                                <label for="anon-phone" class="anon-label">
                                    <input type="checkbox" id="anon-phone" class="anon-check">
                                    익명
                                </label>
                            </div>
                        </div>

                        <button id="to-connection-screen-btn" type="submit" class="primary-button" disabled>다음 단계 (기기
                            연결)</button>
                    </form>
                </div>
            </section>

            <section id="device-connection-screen" class="screen">
                <h2>기기 연결</h2>
                <div class="content-card" style="text-align: center;">
                    <div id="connection-status-icon" style="font-size: 80px; margin-bottom: 20px;">🔌</div>
                    <h3 id="connection-status-title">기기를 연결해주세요</h3>
                    <p id="connection-status-desc">
                        Android 기기를 USB 케이블로 연결하고<br>
                        화면에서 <strong>'USB 디버깅 허용'</strong>을 눌러주세요.
                    </p>
                    <div id="start-scan-container" style="display: none; margin-top: 30px;">
                        <button id="real-start-scan-btn" class="primary-button">검사 시작하기</button>
                    </div>
                    <br>
                    <button id="back-to-info-btn" class="secondary-button" style="width: 100%;">← 뒤로 가기</button>
                </div>
            </section>

            <section id="open-scan-screen" class="screen">
                <h2>검사 열기</h2>
                <p>이전에 저장된 검사 결과 파일을 선택하여 불러옵니다.</p>
                <div class="content-card file-drop-zone">
                    <p>아래 버튼을 클릭하여 파일을 선택하세요.</p>
                    <button id="select-file-btn" type="button" class="secondary-button">파일 선택</button>
                </div>
            </section>

            <section id="scan-progress-screen" class="screen">
                <h2>검사 진행 중</h2>
                <div class="content-card scan-animation-card">
                    <div class="scanner-animation">
                        <div class="radar"></div>
                        <div class="device-icon">📱</div>
                    </div>
                    <p id="scan-status-text">기기 연결을 확인하는 중...</p>
                    <div class="progress-bar-container">
                        <div id="progress-bar" style="width: 0%;"></div>
                    </div>
                    <div class="warning-box">
                        <img src="./assets/icon-warning.png" alt="Warning">
                        <span><strong>경고:</strong> 검사가 완료될 때까지 USB 케이블을 절대 분리하지 마십시오.</span>
                    </div>
                </div>
            </section>

            <section id="scan-results-screen" class="screen">
                <div class="results-header">
                    <h2>정밀 검사 결과 보고서</h2>
                    <div class="header-buttons">
                        <button id="print-results-btn" type="button" class="secondary-button print-button">PDF
                            출력</button>
                        <button id="report-results-btn" type="button" class="secondary-button send-button"
                            style="color: #eee; border-color: #3A539B;">
                            결과 전송
                        </button>
                        <button id="disconnect-btn" type="button" class="secondary-button danger-button">연결 끊기</button>
                    </div>
                </div>

                <div id="results-dashboard-view">
                    <div class="content-card info-summary-card">
                        <h3>📱 기기 정보 </h3>
                        <div class="device-info-grid">
                            <div class="info-item"><span class="label">모델명</span><span class="value"
                                    id="res-model">-</span></div>
                            <div class="info-item"><span class="label">일련번호(S/N)</span><span class="value"
                                    id="res-serial">-</span></div>
                            <div class="info-item"><span class="label">루팅 여부</span><span class="value"
                                    id="res-root">-</span></div>
                            <div class="info-item"><span class="label">전화번호</span><span class="value"
                                    id="res-phone">-</span></div>
                        </div>
                    </div>
                    <div class="content-card warning-card">
                        <h3>⚠️ 탐지 결과</h3>
                        <div id="suspicious-list-container"></div>
                    </div>
                    <div class="content-card">
                        <h3>📲 설치된 애플리케이션</h3>
                        <p class="sub-text">아이콘을 클릭하면 <strong>권한 상세 내역</strong> 및 <strong>백그라운드 실행 여부</strong>를 확인할 수
                            있습니다.</p>
                        <div id="app-grid-container" class="app-grid"></div>
                    </div>
                    <div class="content-card">
                        <h3>🚀 백그라운드 실행 중인 앱</h3>
                        <p class="sub-text">현재 사용자 몰래 <strong>백그라운드에서 작동 중인</strong> 앱 목록입니다.</p>
                        <div id="bg-app-grid-container" class="app-grid"></div>
                    </div>
                    <div class="content-card">
                        <h3>📂 발견된 설치 파일 (.apk)</h3>
                        <ul id="res-apk-list" class="file-list"></ul>
                    </div>
                </div>

                <div id="app-detail-view" class="hidden">
                    <button id="back-to-dashboard-btn" class="secondary-button" style="margin-bottom: 15px;">← 목록으로
                        돌아가기</button>
                    <div class="content-card detail-card">
                        <div class="detail-header">
                            <div class="detail-icon-wrapper">
                                <img src="./assets/icon-android.svg" class="detail-app-icon" alt="App Icon">
                            </div>
                            <div class="detail-title-area">
                                <h2 id="detail-app-name">Application Name</h2>
                                <p id="detail-package-name">com.package.name</p>
                            </div>
                            <div class="action-buttons">
                                <button id="uninstall-btn" class="secondary-button danger-button">🗑️ 앱 강제 삭제</button>
                                <button id="neutralize-btn" class="secondary-button warning-button">🛡️ 무력화 (권한
                                    박탈)</button>
                            </div>
                        </div>
                        <div class="detail-grid">
                            <div class="detail-item"><span class="d-label">설치 경로</span><span class="d-value"
                                    id="detail-sideload">-</span></div>
                            <div class="detail-item"><span class="d-label">백그라운드 실행</span><span class="d-value"
                                    id="detail-bg">-</span></div>
                            <div class="detail-item"><span class="d-label">데이터 사용량</span><span class="d-value"
                                    id="detail-network" style="font-family: monospace;">-</span></div>
                        </div>
                        <div class="permission-stats"
                            style="text-align: right; margin-top: 10px; color: #666; font-size: 13px;">
                            <span>요청 권한: <strong id="detail-req-count">0</strong>개</span>
                            <span style="margin: 0 5px;">|</span>
                            <span>허용된 권한: <strong id="detail-grant-count" style="color: #2e7d32;">0</strong>개</span>
                        </div>
                        <hr class="divider">
                        <h3>권한 상세 분석 (Permissions Detail)</h3>
                        <div class="permission-legend">
                            <span class="badge badge-grant">✅ 허용됨</span>
                            <span class="badge badge-deny">🚫 거부됨 / 미사용</span>
                        </div>
                        <div id="detail-permission-list" class="permission-list-container"></div>
                    </div>
                </div>
            </section>

            <div id="admin-screen" class="screen">

                <div class="admin-top-header">
                    <h2 style="margin: 0;">🛡️ 관리자 대시보드</h2>
                    <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;">
                        업체 관리 및 검사 리포트 조회 시스템
                    </p>
                </div>

                <div class="admin-tabs">
                    <button class="admin-tab-btn active" data-target="admin-tab-register">
                        ➕ 업체 등록
                    </button>
                    <button class="admin-tab-btn" data-target="admin-tab-list">
                        🏢 업체 목록
                    </button>
                    <button class="admin-tab-btn" data-target="admin-tab-reports">
                        📩 전송된 기록
                    </button>
                </div>

                <div class="admin-content-area">

                    <div id="admin-tab-register" class="admin-tab-content active">
                        <div class="content-card">
                            <h3>신규 업체 계정 생성</h3>
                            <p style="margin-bottom: 20px; color: #666;">
                                파트너 업체의 정보를 입력하여 계정을 생성합니다.
                            </p>
                            <form id="admin-create-user-form">
                                <div class="form-group">
                                    <label>업체명 (Company Name)</label>
                                    <input type="text" id="new-user-name" placeholder="예: 빅드림 시큐리티" required>
                                </div>

                                <div class="form-group">
                                    <label>업체 아이디 (ID)</label>
                                    <input type="text" id="new-user-id" placeholder="예: agency_seoul" required>
                                </div>
                                <div class="form-group">
                                    <label>초기 비밀번호</label>
                                    <input type="text" id="new-user-pwd" placeholder="비밀번호 입력" required>
                                </div>
                                <div class="form-group">
                                    <label>기본 검사 횟수 (Quota)</label>
                                    <input type="number" id="new-user-quota" value="40" style="width: 150px;">
                                </div>
                                <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                                    <button type="submit" class="primary-button" style="width: 200px;">계정 생성하기</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div id="admin-tab-list" class="admin-tab-content">
                        <div class="content-card">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                                <h3>등록된 업체 현황</h3>
                                <button id="refresh-users-btn" class="secondary-button">🔄 새로고침</button>
                            </div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>업체명 (ID)</th>
                                        <th>상태</th>
                                        <th>잔여 횟수</th>
                                        <th>최근 접속/검사</th>
                                        <th>기능 제어</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-user-list-body">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div id="admin-tab-reports" class="admin-tab-content">
                        <div class="content-card">
                            <div
                                style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                                <h3>전송된 리포트 목록</h3>
                                <button id="refresh-reports-btn" class="secondary-button">🔄 새로고침</button>
                            </div>
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th width="15%">전송 일시</th>
                                        <th width="15%">업체명</th>
                                        <th>메시지/사유</th>
                                        <th width="15%">검사 결과</th>
                                        <th width="10%">보기</th>
                                    </tr>
                                </thead>
                                <tbody id="admin-reports-body">
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
            </div>
            <link rel="stylesheet" href="print.css" media="print">
            <div id="printable-report" style="display: none;">
            </div>

            <div id="admin-modal" class="modal hidden">
                <div class="modal-content">
                    <h3 style="margin-top:0; color:#333;">⚡ 관리자 설정</h3>
                    <p style="font-size:14px; color:#666; margin-bottom:15px;">
                        안드로이드 검사 소요 시간(분)을 입력하세요.<br>
                        <span style="font-size:12px;">(범위: 10~60, 해제: 0)</span>
                    </p>
                    <input type="number" id="admin-input" placeholder="0"
                        style="width:100%; padding:10px; margin-bottom:20px; box-sizing:border-box; border:1px solid #ddd; border-radius:4px;">
                    <div style="display:flex; justify-content:flex-end; gap:10px;">
                        <button id="admin-cancel-btn" class="secondary-button">취소</button>
                        <button id="admin-save-btn" class="primary-button">저장</button>
                    </div>
                </div>
            </div>


            <div id="custom-alert-modal" class="modal hidden" style="z-index: 10000;">
                <div class="modal-content" style="width: 300px; text-align: center;">
                    <div style="font-size: 40px; margin-bottom: 10px;">📢</div>
                    <p id="custom-alert-msg"
                        style="color: #333; font-weight: 500; white-space: pre-line; margin-bottom: 20px;">
                        알림 내용
                    </p>
                    <button id="custom-alert-ok-btn" class="primary-button" style="width: 100%;">확인</button>
                </div>
            </div>

            <div id="custom-confirm-modal" class="modal hidden" style="z-index: 10000;">
                <div class="modal-content" style="width: 320px; text-align: center;">
                    <div style="font-size: 40px; margin-bottom: 10px;">🤔</div>
                    <p id="custom-confirm-msg"
                        style="color: #333; font-weight: 500; white-space: pre-line; margin-bottom: 20px;">
                        진행하시겠습니까?
                    </p>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button id="custom-confirm-cancel-btn" class="secondary-button" style="flex: 1;">취소</button>
                        <button id="custom-confirm-ok-btn" class="primary-button" style="flex: 1;">확인</button>
                    </div>
                </div>
            </div>

            <div id="admin-result-modal" class="modal hidden">
                <div class="modal-content" style="width: 500px; max-height: 80vh; overflow-y: auto;">
                    <h3>📊 검사 이력 확인</h3>
                    <div id="admin-result-content">로딩 중...</div>
                    <div style="text-align: right; margin-top: 20px;">
                        <button id="admin-result-close-btn" class="secondary-button">닫기</button>
                    </div>
                </div>
            </div>

 <section id="admin-report-detail-screen" class="screen">
    <div class="detail-top-bar">
        <div class="left">
            <button id="admin-detail-back-btn" class="secondary-button">⬅ 목록으로</button>
            <span class="page-title">검사 결과 상세 리포트</span>
        </div>
        <div class="right">
            <span class="badge-id" id="view-doc-id">DOC-ID</span>
            <span class="badge-date" id="view-report-time">-</span>
        </div>
    </div>

    <div class="report-container">
        <div class="summary-row">
            <div class="info-card">
                <div class="card-head">🏢 전송 업체</div>
                <div class="card-body">
                    <div class="field-row">
                        <label>업체명</label> <span id="view-agency-name">-</span>
                    </div>
                    <div class="field-row">
                        <label>아이디</label> <span id="view-agency-id">-</span>
                    </div>
                    <div class="field-row">
                        <label>이메일</label> <span id="view-agency-email">-</span>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-head">👤 고객 정보</div>
                <div class="card-body">
                    <div class="field-row">
                        <label>이름</label> <span id="view-client-name">-</span>
                    </div>
                    <div class="field-row">
                        <label>연락처</label> <span id="view-client-phone">-</span>
                    </div>
                    <div class="field-row">
                        <label>생년월일</label> <span id="view-client-dob">-</span>
                    </div>
                </div>
            </div>

            <div class="info-card">
                <div class="card-head">📱 디바이스</div>
                <div class="card-body">
                    <div class="field-row">
                        <label>모델명</label> <span id="view-device-model" style="font-weight:bold; color:#3A539B;">-</span>
                    </div>
                    <div class="field-row">
                        <label>OS</label> <span id="view-device-os">-</span>
                    </div>
                    <div class="field-row">
                        <label>Serial</label> <span id="view-device-serial">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="message-section">
            <label>💬 전달 메시지</label>
            <div id="view-message-text" class="message-box">내용 없음</div>
        </div>

        <div class="threat-section">
            <div class="section-header">
                <h3>🚨 탐지된 위협 애플리케이션 (<span id="view-threat-count">0</span>건)</h3>
            </div>
            <div id="view-threat-list" class="threat-list-container">
            </div>
        </div>
    </div>
</section>


            <div id="printable-report" style="display: none;" >

                <div class="print-page">
                    <header class="report-header">
                        <div class="header-logo">
                            <span class="bd-logo">BD-SCANNER</span> | Mobile Forensics
                        </div>
                        <div class="header-confidential">
                            CONFIDENTIAL / LAW ENFORCEMENT SENSITIVE
                        </div>
                    </header>

                    <div class="report-title-box">
                        <h1>모바일 정밀 보안 검사 결과서</h1>
                        <p>Mobile Device Security Inspection Report</p>
                    </div>

                    <div class="report-section">
                        <h3 class="section-heading">1. 검사 개요 (Inspection Overview)</h3>
                        <table class="info-table">
                            <tr>
                                <th>문서 번호</th>
                                <td id="print-doc-id">-</td>
                                <th>검사 일시</th>
                                <td id="print-date">-</td>
                            </tr>
                            <tr>
                                <th>검사 도구</th>
                                <td>BD-Scanner Pro v1.0</td>
                                <th>검사관</th>
                                <td>Administrator</td>
                            </tr>
                        </table>
                    </div>

                    <div class="report-section">
                        <h3 class="section-heading">2. 타겟 디바이스 정보 (Target Device)</h3>
                        <table class="info-table">
                            <tr>
                                <th>모델명</th>
                                <td id="print-model">-</td>
                                <th>일련번호 (S/N)</th>
                                <td id="print-serial">-</td>
                            </tr>
                            <tr>
                                <th>전화번호</th>
                                <td id="print-phone">-</td>
                                <th>루팅 / 탈옥</th>
                                <td id="print-root">-</td>
                            </tr>
                        </table>
                    </div>

                    <div class="report-section">
                        <h3 class="section-heading">3. 종합 판정 (Executive Summary)</h3>
                        <div id="print-summary-box" class="summary-box"></div>
                        <div class="summary-stats">
                            <div class="stat-item">
                                <span class="stat-label">분석된 앱</span>
                                <span class="stat-value" id="print-total-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">위협 탐지</span>
                                <span class="stat-value text-danger" id="print-threat-count">0</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-label">의심 파일</span>
                                <span class="stat-value" id="print-file-count">0</span>
                            </div>
                        </div>
                    </div>

                    <div class="report-section">
                        <h3 class="section-heading text-danger">4. 위협 탐지 상세 내역 (Threat Details)</h3>
                        <p class="section-desc">알려진 악성 패턴, 스파이웨어 동작, 비정상 권한 사용이 탐지된 항목입니다.</p>
                        <div id="print-threat-container">
                        </div>
                    </div>

                    <div class="report-section">
                        <h3 class="section-heading">5. 파일 시스템 분석 (File Artifacts)</h3>
                        <p class="section-desc">내장 메모리(/sdcard)에서 발견된 설치 파일(.apk) 목록입니다.</p>
                        <table class="detail-table">
                            <thead>
                                <tr>
                                    <th width="10%">No.</th>
                                    <th>파일 경로 (Path)</th>
                                </tr>
                            </thead>
                            <tbody id="print-file-body">
                            </tbody>
                        </table>
                    </div>

                    <div class="report-footer-space">
                        <p class="disclaimer">
                            본 보고서는 BD-Scanner의 자동화된 분석 결과이며, 법적 증거 자료의 참고용으로 사용될 수 있습니다.<br>
                            This report is generated by automated analysis and can be used as a reference for legal
                            evidence.
                        </p>
                    </div>
                </div>

                <div class="print-page">
                    <h3 class="section-heading">6. [부록] 전체 설치 애플리케이션 (Installed Applications)</h3>
                    <p class="section-desc">디바이스에 설치된 모든 애플리케이션 목록 (시스템 앱 제외)</p>

                    <div id="print-all-apps-grid" class="compact-app-grid">
                    </div>

                    <footer class="report-footer">
                        <div class="footer-left">Generated by BigDream Security Solutions</div>
                    </footer>
                </div>

            </div>
</body>


</html>